<!DOCTYPE html>
<html lang="en" >
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="為了可能的聲音"> 
    <meta name="author" content="Rex Tsou">
    <meta name="copyright" content="Rex Tsou">
    
    <meta property="og:title" content="利用URL.createObjectURL方法，即時產生可下載檔案">
    <meta property="og:type" content="article">
    <meta property="og:description" content="為了可能的聲音">
    
    <meta itemprop="name" content="利用URL.createObjectURL方法，即時產生可下載檔案 | 為了可能的聲音">
    <meta itemprop="description" content="為了可能的聲音">
    <title>利用URL.createObjectURL方法，即時產生可下載檔案 | 為了可能的聲音</title>
    <link rel="stylesheet" href="https://blog.rex-tsou.com/css/style.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css"> 
  </head>

<header class="section header">
  <div class="container">
    <nav class="nav">
      <div class="nav__left">
        <a class="nav__item" href="https://blog.rex-tsou.com"><h1 class="title">為了可能的聲音</h1></a>
      </div>
      <div class="nav__right">
        <nav class="nav__item">
          <a class="item__link" href="/post">Archives</a>
        </nav>
        <nav class="nav__item">
          
          <a class="item__link" href="https://github.com/akccakcctw" target="_blank" rel="noopener">
            <span class="icon">
              <i class="fa fa-github"></i>
            </span>
          </a>
          
          <a class="item__link" href="https://www.facebook.com/akccakcctw" target="_blank" rel="noopener">
            <span class="icon">
              <i class="fa fa-facebook-square"></i>
            </span>
          </a>
          
          <a class="item__link" href="/index.xml" target="_blank" rel="noopener">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>
          </a>
          
        </nav>
      </div>
    </nav>
  </div>
</header>

<section class="section">
  <div class="container">
    <time class="date date--publish">April 19, 2016</time>
    
      <div class="category">
  
  <span class="category__item">
    <a href="/categories/html5">HTML5</a>
  </span>
  
  <span class="category__item">
    <a href="/categories/javascript">JavaScript</a>
  </span>
  
</div>

    
    <h1 class="title">利用URL.createObjectURL方法，即時產生可下載檔案</h1>
    <div class="content">
      <p>最近在看 HTML5 的一些 API，發現有不少好用的功能，剛才看到<a href="http://blog.darkthread.net/post-2014-03-12-html5-object-url.aspx">黑暗執行緒</a>這篇介紹，可以利用<code>URL.createObjectURL</code>，將物件內容暫時存在瀏覽器記憶體中，並且可以產生下載連結！</p>
<p>馬上嘗試了一下，還挺好用的。話不多說，以下是程式碼，寫在這邊作為分享，也作為自己的備忘筆記：</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;

&lt;<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
    &lt;<span style="color:#f92672">title</span>&gt;URL.createObjectURL demo&lt;/<span style="color:#f92672">title</span>&gt;
    &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://code.jquery.com/jquery-2.2.3.min.js&#34;</span> <span style="color:#a6e22e">integrity</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo=&#34;</span> <span style="color:#a6e22e">crossorigin</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;anonymous&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
    &lt;<span style="color:#f92672">style</span>&gt;
    <span style="color:#f92672">body</span> {
        <span style="color:#66d9ef">font-family</span>: <span style="color:#66d9ef">monospace</span>;
    }
    
    #file_content<span style="color:#f92672">,</span>
    #file_name {
        <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">block</span>;
        <span style="color:#66d9ef">background</span>: <span style="color:#ae81ff">#777</span>;
        <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#fff</span>;
        <span style="color:#66d9ef">border</span>: <span style="color:#66d9ef">none</span>;
        <span style="color:#66d9ef">border-radius</span>: <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span>;
        <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">10</span><span style="color:#66d9ef">px</span>;
        <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">16</span><span style="color:#66d9ef">px</span>;
        <span style="color:#66d9ef">font-family</span>: <span style="color:#66d9ef">monospace</span>;
        <span style="color:#66d9ef">margin-bottom</span>: <span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span>;
    }
    
    #create_file<span style="color:#f92672">,</span>
    #revoke_file {
        <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">10</span><span style="color:#66d9ef">px</span>;
        <span style="color:#66d9ef">border</span>: <span style="color:#66d9ef">none</span>;
        <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#fff</span>;
        <span style="color:#66d9ef">background</span>: <span style="color:#ae81ff">#333</span>;
        <span style="color:#66d9ef">transition</span>: <span style="color:#ae81ff">0.3</span><span style="color:#66d9ef">s</span>;
        <span style="color:#66d9ef">cursor</span>: <span style="color:#66d9ef">pointer</span>;
    }
    
    #create_file:<span style="color:#a6e22e">hover</span><span style="color:#f92672">,</span>
    #revoke_file:<span style="color:#a6e22e">hover</span> {
        <span style="color:#66d9ef">background</span>: <span style="color:#ae81ff">#777</span>;
    }
    
    #create_file:<span style="color:#a6e22e">active</span><span style="color:#f92672">,</span>
    #revoke_file:<span style="color:#a6e22e">active</span> {
        <span style="color:#66d9ef">background</span>: <span style="color:#ae81ff">#000</span>;
    }
    
    #download_link {
        <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">10</span><span style="color:#66d9ef">px</span>;
    }
    
    .<span style="color:#a6e22e">revoke</span> {
        <span style="color:#66d9ef">text-decoration</span>: <span style="color:#66d9ef">line-through</span>;
        <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#f00</span>;
    }
    &lt;/<span style="color:#f92672">style</span>&gt;
&lt;/<span style="color:#f92672">head</span>&gt;

&lt;<span style="color:#f92672">body</span>&gt;
<span style="color:#75715e">&lt;!--</span><span style="color:#75715e"> 
</span><span style="color:#75715e">key code:
</span><span style="color:#75715e">URL.createObjectURL() 
</span><span style="color:#75715e">URL.revokeObjectURL()
</span><span style="color:#75715e"></span><span style="color:#75715e">--&gt;</span>
    &lt;<span style="color:#f92672">textarea</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file_content&#34;</span> <span style="color:#a6e22e">cols</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;30&#34;</span> <span style="color:#a6e22e">rows</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;10&#34;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file content&#34;</span> <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file content&#34;</span>&gt;&lt;/<span style="color:#f92672">textarea</span>&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file_name&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file name&#34;</span> <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file name&#34;</span>&gt;
    &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;create_file&#34;</span>&gt;Gen File&lt;/<span style="color:#f92672">button</span>&gt;
    &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;revoke_file&#34;</span>&gt;Revoke File&lt;/<span style="color:#f92672">button</span>&gt;
    &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;download_link&#34;</span> <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;click to download&#34;</span>&gt;&lt;/<span style="color:#f92672">a</span>&gt;
    &lt;<span style="color:#f92672">script</span>&gt;
    <span style="color:#a6e22e">$</span>(<span style="color:#66d9ef">function</span>() {
        <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#create_file&#34;</span>).<span style="color:#a6e22e">click</span>(<span style="color:#66d9ef">function</span>() {
            <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#download_link&#34;</span>).<span style="color:#a6e22e">removeClass</span>(<span style="color:#e6db74">&#34;revoke&#34;</span>);
            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">blob</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Blob</span>([<span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#file_content&#34;</span>).<span style="color:#a6e22e">val</span>()], {
                <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;application/octect-stream&#34;</span>
            });
            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">blobUrl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">createObjectURL</span>(<span style="color:#a6e22e">blob</span>);
            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fileName</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#file_name&#34;</span>).<span style="color:#a6e22e">val</span>();

            <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#download_link&#34;</span>).<span style="color:#a6e22e">attr</span>({
                <span style="color:#a6e22e">href</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">blobUrl</span>,
                <span style="color:#a6e22e">download</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">fileName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.txt&#34;</span>,

            }).<span style="color:#a6e22e">text</span>(<span style="color:#a6e22e">fileName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.txt&#34;</span>);

        });

        <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#revoke_file&#34;</span>).<span style="color:#a6e22e">click</span>(<span style="color:#66d9ef">function</span>() {
            <span style="color:#a6e22e">blobUrl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">revokeObjectURL</span>(<span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#download_link&#34;</span>).<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#34;href&#34;</span>));
            <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#download_link&#34;</span>).<span style="color:#a6e22e">addClass</span>(<span style="color:#e6db74">&#34;revoke&#34;</span>);
        })
    });
    &lt;/<span style="color:#f92672">script</span>&gt;
&lt;/<span style="color:#f92672">body</span>&gt;

&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><h2 id="heading">參考資料</h2>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL">Mozilla Developer: createObjectURL</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/URL/revokeObjectURL">Mozilla Developer: revokeObjectURL</a></li>
<li><a href="http://blog.darkthread.net/post-2014-03-12-html5-object-url.aspx">黑暗執行緒：HTML5筆記–Object URL</a></li>
</ul>

    </div>
    <blockquote class="page-info">
      最後更新時間：<time class="date date--update">April 19, 2016</time>
    </blockquote>
  </div>
</section>

<section class="section disqus">
  <div class="container">
    <aside><div id="disqus_thread"></div></aside>
    <script type="text/javascript">
      var disqus_shortname = 'akccakcctw';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</section>



<footer class="section footer">
  <div class="container">
    <p>© 2018 <a href="https://github.com/akccakcctw" target="_blank">Rex Tsou</a></p>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/vim.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scss.min.js"></script>

<script>hljs.initHighlightingOnLoad();</script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-57924156-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



